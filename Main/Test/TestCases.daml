module Main.Test.TestCases where

--- File Imports
import Daml.Script
import Main.Loan.Loan
import Main.Loan.LoanRequest

testLoanApprovalWorkflow : Script ()

testLoanApprovalWorkflow = script
  do
    -- Create parties for borrower and bank
    debug "Declaring parties..."
    borrower <- allocateParty "Shalabh"
    bank <- allocateParty "SBI"
    auditor <- allocateParty "RBI"

    -- Borrower creates a LoanRequest
    debug "Borrowing party creating loan request..."
    loanRequestCid <- submit borrower do
      createCmd LoanRequest with borrower = borrower,
                                  bank = bank,
                                  amount = 1000.0,
                                  auditor = auditor,
                                  memo = "Home loan request"

    debug "Bank approves loan request..."
    -- Bank approves the LoanRequest
    loanCid <- submit bank do
      exerciseCmd loanRequestCid ApproveRequest with _approver = bank, memo = "Home loan approved"

    return ()
